# SublinkX v2.2 æ›´æ–°æ—¥å¿—

## ğŸ¯ ç‰ˆæœ¬å‡çº§æ€»ç»“

æœ¬æ¬¡æ›´æ–°å°† SublinkX ä» v2.1 å‡çº§åˆ° v2.2ï¼Œä¸»è¦åŒ…å«æ™ºèƒ½ä»£ç†ç»„é€‰æ‹©ä¼˜åŒ–å’Œå®Œæ•´çš„ CI/CD æµç¨‹å»ºè®¾ã€‚

## ğŸ‰ æ ¸å¿ƒåŠŸèƒ½æ”¹è¿›

### 1. æ™ºèƒ½ä»£ç†ç»„é€‰æ‹©ç­–ç•¥

#### é—®é¢˜èƒŒæ™¯
- åŸç‰ˆæœ¬å‘æ‰€æœ‰ä»£ç†ç»„æ·»åŠ èŠ‚ç‚¹ï¼Œå¯¼è‡´é…ç½®å†—ä½™
- ç”¨æˆ·åé¦ˆå¸Œæœ›åªå‘ç‰¹å®šä»£ç†ç»„ï¼ˆå¦‚"èŠ‚ç‚¹é€‰æ‹©"ã€"è‡ªåŠ¨é€‰æ‹©"ï¼‰æ·»åŠ èŠ‚ç‚¹

#### è§£å†³æ–¹æ¡ˆ
- **å…³é”®è¯åŒ¹é…**ï¼šåªå‘åŒ…å«ç‰¹å®šå…³é”®è¯çš„ä»£ç†ç»„æ·»åŠ èŠ‚ç‚¹
- **æ”¯æŒå…³é”®è¯**ï¼š`èŠ‚ç‚¹é€‰æ‹©`ã€`è‡ªåŠ¨é€‰æ‹©`ã€`æ‰‹åŠ¨åˆ‡æ¢`
- **æ— æ•°é‡é™åˆ¶**ï¼šç§»é™¤æœ€å¤š2ä¸ªä»£ç†ç»„çš„é™åˆ¶ï¼Œæ”¯æŒä»»æ„æ•°é‡ç¬¦åˆæ¡ä»¶çš„ä»£ç†ç»„

#### ä»£ç å˜æ›´
```go
// ä¿®æ”¹å‰ï¼šå¤æ‚çš„å¤šé‡åˆ¤æ–­ + æ•°é‡é™åˆ¶
addedCount := 0
maxAddGroups := 2
if addedCount >= maxAddGroups { break }

// ä¿®æ”¹åï¼šç®€æ´çš„å…³é”®è¯åŒ¹é…
keywords := []string{"èŠ‚ç‚¹é€‰æ‹©", "è‡ªåŠ¨é€‰æ‹©", "æ‰‹åŠ¨åˆ‡æ¢"}
for _, keyword := range keywords {
    if strings.Contains(groupName, keyword) {
        shouldAddNodes = true
        break
    }
}
```

#### å®é™…æ•ˆæœ
```yaml
proxy-groups:
  - name: ğŸ”° èŠ‚ç‚¹é€‰æ‹©    # âœ… ä¼šæ·»åŠ èŠ‚ç‚¹
  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©    # âœ… ä¼šæ·»åŠ èŠ‚ç‚¹  
  - name: ğŸš€ æ‰‹åŠ¨åˆ‡æ¢    # âœ… ä¼šæ·»åŠ èŠ‚ç‚¹
  - name: ğŸ¥ NETFLIX     # âŒ ä¸ä¼šæ·»åŠ èŠ‚ç‚¹
  - name: â›”ï¸ å¹¿å‘Šæ‹¦æˆª    # âŒ ä¸ä¼šæ·»åŠ èŠ‚ç‚¹
```

## ğŸ”§ CI/CD æµç¨‹å»ºè®¾

### 1. GitHub Actions è‡ªåŠ¨æ„å»º

#### æ–°å¢æ–‡ä»¶
- `.github/workflows/build.yml` - å¤šå¹³å°äºŒè¿›åˆ¶æ„å»º
- `.github/workflows/docker.yml` - Docker é•œåƒæ„å»º

#### æ”¯æŒå¹³å°
- **Linux**: amd64, arm64
- **Windows**: amd64
- **macOS**: amd64 (Intel), arm64 (Apple Silicon)

#### è§¦å‘æ¡ä»¶
- æ¨é€æ ‡ç­¾ (v*)
- æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)

### 2. è‡ªåŠ¨å‘å¸ƒæµç¨‹

#### å‘å¸ƒè„šæœ¬
- `scripts/release.sh` - Linux/macOS å‘å¸ƒè„šæœ¬
- `scripts/release.bat` - Windows å‘å¸ƒè„šæœ¬

#### å‘å¸ƒæµç¨‹
1. æ›´æ–°ç‰ˆæœ¬å·
2. æäº¤ä»£ç å˜æ›´
3. åˆ›å»º Git æ ‡ç­¾
4. æ¨é€åˆ°è¿œç¨‹ä»“åº“
5. è§¦å‘ GitHub Actions
6. è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ

### 3. Docker ä¼˜åŒ–

#### Dockerfile æ”¹è¿›
- **å¤šé˜¶æ®µæ„å»º**ï¼šå‰ç«¯æ„å»º â†’ åç«¯æ„å»º â†’ æœ€ç»ˆé•œåƒ
- **é•œåƒä¼˜åŒ–**ï¼šä½¿ç”¨ Alpine Linuxï¼Œå‡å°é•œåƒä½“ç§¯
- **å¥åº·æ£€æŸ¥**ï¼šæ·»åŠ å®¹å™¨å¥åº·æ£€æŸ¥
- **å¤šæ¶æ„æ”¯æŒ**ï¼šlinux/amd64, linux/arm64

#### Docker Compose æ›´æ–°
- **ç”Ÿäº§é…ç½®**ï¼š`docker-compose.yml`
- **å¼€å‘é…ç½®**ï¼š`docker-compose.dev.yml`
- **æ•°æ®æŒä¹…åŒ–**ï¼šæ­£ç¡®çš„å·æŒ‚è½½é…ç½®

## ğŸ“¦ é¡¹ç›®ç»“æ„ä¼˜åŒ–

### æ–°å¢æ–‡ä»¶

```
sublinkX/
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ build.yml          # äºŒè¿›åˆ¶æ„å»ºå·¥ä½œæµ
â”‚   â””â”€â”€ docker.yml         # Docker æ„å»ºå·¥ä½œæµ
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ release.sh         # Linux/macOS å‘å¸ƒè„šæœ¬
â”‚   â”œâ”€â”€ release.bat        # Windows å‘å¸ƒè„šæœ¬
â”‚   â””â”€â”€ test-install.sh    # å®‰è£…æµ‹è¯•è„šæœ¬
â”œâ”€â”€ Makefile               # æ„å»ºå·¥å…·
â”œâ”€â”€ docker-compose.dev.yml # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ DEPLOYMENT.md          # éƒ¨ç½²æŒ‡å—
â””â”€â”€ CHANGELOG-v2.2.md      # æœ¬æ›´æ–°æ—¥å¿—
```

### æ›´æ–°æ–‡ä»¶

- `main.go` - ç‰ˆæœ¬å·æ›´æ–°åˆ° 2.2
- `node/clash.go` - æ™ºèƒ½ä»£ç†ç»„é€‰æ‹©é€»è¾‘
- `README.md` - å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£
- `install.sh` - ä¿®æ­£ GitHub ä»“åº“åœ°å€
- `Dockerfile` - å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- `docker-compose.yml` - ç”Ÿäº§ç¯å¢ƒé…ç½®
- `.gitignore` - å®Œå–„å¿½ç•¥è§„åˆ™

## ğŸš€ éƒ¨ç½²æ”¹è¿›

### 1. ä¸€é”®å®‰è£…ä¼˜åŒ–

#### ä¿®å¤é—®é¢˜
- ä¿®æ­£ GitHub ä»“åº“åœ°å€ï¼š`gooaclok819/sublinkX` â†’ `moshouhot/sublinkX`
- ç¡®ä¿å®‰è£…è„šæœ¬å¯æ­£å¸¸è®¿é—®å’Œæ‰§è¡Œ

#### å®‰è£…å‘½ä»¤
```bash
curl -s -H "Cache-Control: no-cache" -H "Pragma: no-cache" https://raw.githubusercontent.com/moshouhot/sublinkX/main/install.sh | sudo bash
```

### 2. å¤šç§éƒ¨ç½²æ–¹å¼

#### Docker éƒ¨ç½²
```bash
# ä½¿ç”¨é¢„æ„å»ºé•œåƒ
docker run --name sublinkx -p 8000:8000 \
  -v $PWD/db:/app/db \
  -v $PWD/template:/app/template \
  -v $PWD/logs:/app/logs \
  -d jaaksi/sublinkx:latest
```

#### æ‰‹åŠ¨ç¼–è¯‘
```bash
# ä½¿ç”¨ Makefile
make build

# æˆ–ä¼ ç»Ÿæ–¹å¼
cd webs && npm install && npm run build && cd ..
go mod tidy && go build -o sublinkx main.go
```

## ğŸ“‹ å¼€å‘å·¥å…·æ”¹è¿›

### 1. Makefile æ”¯æŒ

æä¾›ç»Ÿä¸€çš„æ„å»ºå‘½ä»¤ï¼š
- `make build` - å®Œæ•´æ„å»º
- `make build-all` - å¤šå¹³å°ç¼–è¯‘
- `make dev` - å¼€å‘æœåŠ¡å™¨
- `make test` - è¿è¡Œæµ‹è¯•
- `make clean` - æ¸…ç†æ„å»ºæ–‡ä»¶

### 2. å¼€å‘ç¯å¢ƒ

- Docker å¼€å‘ç¯å¢ƒé…ç½®
- ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥å·¥å…·
- è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

## ğŸ” è´¨é‡ä¿è¯

### 1. è‡ªåŠ¨åŒ–æµ‹è¯•

- å®‰è£…ç¯å¢ƒæµ‹è¯•è„šæœ¬
- GitHub Actions æ„å»ºéªŒè¯
- Docker é•œåƒå¥åº·æ£€æŸ¥

### 2. æ–‡æ¡£å®Œå–„

- è¯¦ç»†çš„éƒ¨ç½²æŒ‡å— (`DEPLOYMENT.md`)
- å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ (`README.md`)
- æ•…éšœæ’é™¤æŒ‡å—

## ğŸ¯ ç”¨æˆ·ä½“éªŒæå‡

### 1. é…ç½®ç”Ÿæˆä¼˜åŒ–

- å‡å°‘é…ç½®å†—ä½™ï¼šåªå‘å¿…è¦çš„ä»£ç†ç»„æ·»åŠ èŠ‚ç‚¹
- æé«˜ç”Ÿæˆé€Ÿåº¦ï¼šä¼˜åŒ–åˆå¹¶ç®—æ³•
- å¢å¼ºå¯ç»´æŠ¤æ€§ï¼šæ¸…æ™°çš„ä»£ç†ç»„ç»“æ„

### 2. éƒ¨ç½²ä½“éªŒ

- ä¸€é”®å®‰è£…è„šæœ¬ä¼˜åŒ–
- å¤šç§éƒ¨ç½²æ–¹å¼é€‰æ‹©
- è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£

## ğŸ”„ å‡çº§æŒ‡å—

### ä» v2.1 å‡çº§åˆ° v2.2

1. **å¤‡ä»½æ•°æ®**ï¼š
   ```bash
   cp -r db/ db_backup_$(date +%Y%m%d)
   cp -r template/ template_backup_$(date +%Y%m%d)
   ```

2. **åœæ­¢æœåŠ¡**ï¼š
   ```bash
   systemctl stop sublinkx  # æˆ– docker-compose down
   ```

3. **æ›´æ–°ç¨‹åº**ï¼š
   ```bash
   curl -LO https://github.com/moshouhot/sublinkX/releases/latest/download/sublink_amd64
   mv sublink_amd64 sublinkx && chmod +x sublinkx
   ```

4. **å¯åŠ¨æœåŠ¡**ï¼š
   ```bash
   systemctl start sublinkx  # æˆ– docker-compose up -d
   ```

## ğŸ‰ æ€»ç»“

SublinkX v2.2 æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰ˆæœ¬æ›´æ–°ï¼Œä¸ä»…ä¼˜åŒ–äº†æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿˜å»ºç«‹äº†å®Œæ•´çš„ç°ä»£åŒ–å¼€å‘å’Œéƒ¨ç½²æµç¨‹ã€‚ä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š

- âœ… **æ™ºèƒ½ä»£ç†ç»„é€‰æ‹©**ï¼šè§£å†³é…ç½®å†—ä½™é—®é¢˜
- âœ… **è‡ªåŠ¨åŒ– CI/CD**ï¼šGitHub Actions è‡ªåŠ¨æ„å»ºå‘å¸ƒ
- âœ… **å¤šå¹³å°æ”¯æŒ**ï¼šæ”¯æŒ 5 ç§å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶
- âœ… **Docker ä¼˜åŒ–**ï¼šå¤šæ¶æ„é•œåƒå’Œå®Œå–„çš„å®¹å™¨åŒ–æ–¹æ¡ˆ
- âœ… **å¼€å‘å·¥å…·**ï¼šMakefileã€å‘å¸ƒè„šæœ¬ç­‰å¼€å‘è¾…åŠ©å·¥å…·
- âœ… **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„éƒ¨ç½²å’Œå¼€å‘æŒ‡å—

è¿™äº›æ”¹è¿›ä½¿ SublinkX æ›´åŠ æ˜“ç”¨ã€ç¨³å®šå’Œå¯ç»´æŠ¤ï¼Œä¸ºåç»­ç‰ˆæœ¬çš„å¼€å‘å¥ å®šäº†åšå®åŸºç¡€ã€‚
