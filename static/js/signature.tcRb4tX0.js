import{d as e,r as t,o as n,c as a,e as o,l as s,V as l,W as c,w as r,ae as i,ad as u,an as d,g as h,aL as f}from"./index.DXN_QHOM.js";import{u as v}from"./index.Da-1S4D8.js";import{_ as p}from"./_plugin-vue_export-helper.BCo6x5W8.js";const g={class:"canvas-dom"},m=["src"],w=p(e({__name:"signature",setup(e){const p=t(""),w=t();let _,y=!1;const k=e=>{let t;if(e.offsetX){const{offsetX:n,offsetY:a}=e;t=[n,a]}else{const{top:n,left:a}=w.value.getBoundingClientRect();t=[e.touches[0].clientX-a,e.touches[0].clientY-n]}return t};let C=0,R=0;const x=e=>{[C,R]=k(e),y=!0},L=e=>{if(y){const[t,n]=k(e);!function(e,t,n,a,o){o.beginPath(),o.globalAlpha=1,o.lineWidth=2,o.strokeStyle="#000",o.moveTo(e,t),o.lineTo(n,a),o.closePath(),o.stroke()}(C,R,t,n,_),C=t,R=n}},T=()=>{y&&(y=!1)};n(()=>{_=w.value.getContext("2d")});const U=async()=>{if(E(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=b(w.value.toDataURL(),"签名.png");if(!e)return;const{data:t}=await v(e);D(),p.value=t.url},D=()=>{_.clearRect(0,0,w.value.width,w.value.height)},E=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},M=()=>{if(E(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=w.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},b=(e,t)=>{const n=e.split(",");if(!n.length)return;const a=n[0].match(/:(.*?);/);if(a){const e=atob(n[1]);let o=e.length;const s=new Uint8Array(o);for(;o--;)s[o]=e.charCodeAt(o);return new File([s],t,{type:a[1]})}};return(e,t)=>{const n=u;return o(),a("div",g,[t[3]||(t[3]=s("h3",null,"基于canvas实现的签名组件",-1)),s("header",null,[c(n,{type:"primary",onClick:M},{default:r(()=>[...t[0]||(t[0]=[i("保存为图片",-1)])]),_:1}),c(n,{onClick:U},{default:r(()=>[...t[1]||(t[1]=[i(" 保存到后端 ",-1)])]),_:1}),c(n,{onClick:D},{default:r(()=>[...t[2]||(t[2]=[i(" 清空签名 ",-1)])]),_:1})]),s("canvas",{ref_key:"canvas",ref:w,height:"200",width:"500",onMousedown:x,onMousemove:d(L,["stop","prevent"]),onMouseup:T,onTouchstart:x,onTouchmove:d(L,["stop","prevent"]),onTouchend:T},null,544),h(p)?(o(),a("img",{key:0,src:h(p),alt:"签名"},null,8,m)):l("",!0)])}}}),[["__scopeId","data-v-d1ec2ee9"]]);export{w as default};
