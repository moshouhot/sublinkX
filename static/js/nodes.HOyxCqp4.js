import{d as e,o as a,r as l,C as t,c as o,e as u,W as n,w as r,m as i,V as s,X as d,ae as m,N as c,O as p,ad as v,t as f,l as y,aL as k,aU as w,S as g}from"./index.FgZyWN26.js";import{E as h}from"./el-card.D8y_5AW_.js";import{E as b,a as N}from"./el-table-column.XZCz8zHz.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.Bok0UmkR.js";import"./el-scrollbar.DPEAYqpV.js";import{E as V}from"./el-tag.BMBWf4Nm.js";import{E as j,a as _}from"./el-tabs.86-glla7.js";import"./el-tab-pane.l0sNRNKZ.js";import{E as C}from"./el-dialog.BL__CdU9.js";import{a as x,E as L}from"./el-select.DAWe4nhq.js";import{g as D,G as U,a as E,A as T,U as A,D as I}from"./node._YVKAiPP.js";import"./_baseClone.BiwgEVdZ.js";import"./raf.D6QJqHuO.js";import"./castArray.ClyXRXtL.js";import"./debounce.DVdHkEUe.js";import"./toNumber.Da7Kyath.js";import"./index.DyH_u2dd.js";import"./strings.NXYVWTTV.js";import"./use-dialog.CxWHqOdR.js";import"./refs.Cw5r5QN8.js";import"./index.DS3HpFXC.js";const G={key:4},z=e({__name:"nodes",setup(e){a(async()=>{Z(),ee()});const z=l("add"),S=l([]),R=l(null);l({});const B=l(""),$=l([]),J=l([]),O=l("全部"),F=l(!1),H=l(!1),K=l({Title:"",Name:"",Link:"",GroupName:[]}),Q=l([]),W=l([]),X=l(!1),q=l([]),M=l(""),P=l("1");function Y(){M.value="",K.value={Title:"",Name:"",Link:"",GroupName:[]},B.value="",q.value=[],X.value=!1,F.value=!1,H.value=!1}async function Z(){const{data:e}=await D();e.length>0&&(J.value=$.value=e),W.value=[],e.forEach(e=>{W.value.push(e.Name)})}async function ee(){const{data:e}=await U();Array.isArray(e)&&e.length>0&&(Q.value=e),P.value=Q.value.length>0?"1":"2"}const ae=()=>{z.value="add",F.value=!0,K.value={Title:"添加节点",Name:"",Link:"",GroupName:[]},q.value=[],B.value=""},le=async e=>{const a="add"===z.value;let l=K.value.Link.trim().split(/[\n,]/).map(e=>e.trim()).filter(e=>e);if(a&&0===l.length)k.warning("节点链接不能为空");else{try{if(a){for(const e of l)await T({link:e,group:"1"===P.value?q.value.join(","):B.value});k.success("节点添加成功")}else await A({id:K.value.ID,name:K.value.Name,link:K.value.Link,group:"1"===P.value?q.value.join(","):B.value}),k.success("节点更新成功")}catch(t){k.error((a?"添加":"更新")+"失败")}Z(),ee(),Y()}},te=e=>(e.CreatedAt=new Date(e.CreatedAt).toLocaleString(),e.CreatedAt),oe=(e,a)=>{const l=e.GroupNodes||[];return Array.isArray(l)&&0!==l.length?l.map(e=>e.Name).join(", "):"未分组"},ue=e=>{if(navigator.clipboard)navigator.clipboard.writeText(e).then(()=>{k.success("链接已复制到剪贴板！")}).catch(e=>{k.error("复制失败！请手动复制。")});else{const l=document.createElement("textarea");l.value=e,document.body.appendChild(l),l.select();try{document.execCommand("copy"),k.success("链接已复制到剪贴板！")}catch(a){k.warning("复制失败！")}finally{document.body.removeChild(l)}}},ne=async()=>{if(0!==S.value.length){try{await w.confirm(`你是否要删除选中的 ${S.value.length} 条节点 ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=[];for(const a of S.value)await I({id:a.ID}),e.push(a.ID);k.success("批量删除成功"),$.value=$.value.filter(a=>!e.includes(a.ID))}catch(e){"cancel"!==e&&k.error("批量删除失败！")}await ee(),await Z()}else k.warning("请选择要删除的节点！")},re=()=>{g(()=>{const e=R.value;e&&$.value.forEach(a=>{e.toggleRowSelection(a,!0)})})},ie=()=>{g(()=>{const e=R.value;e&&e.clearSelection()})},se=async()=>{if(0!==S.value.length)try{ue(S.value.map(e=>e.Link).join("\n"))}catch(e){"cancel"!==e&&k.error("批量复制失败")}else k.warning("请选择要复制的节点！")},de=e=>{S.value=e};return t(O,e=>{$.value="全部"===e?J.value:J.value.filter(a=>{var l;return null==(l=a.GroupNodes)?void 0:l.some(a=>a.Name===e)})}),(e,a)=>{const l=d,t=E,g=L,D=x,U=v,T=C,A=_,S=j,J=N,H=V,X=b,me=h;return u(),o("div",null,[n(T,{modelValue:F.value,"onUpdate:modelValue":a[8]||(a[8]=e=>F.value=e),title:K.value.Title,width:"80%"},{default:r(()=>["add"===z.value?(u(),i(l,{key:0,modelValue:K.value.Link,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value.Link=e),placeholder:"请输入节点链接，支持多行使用回车或逗号分开",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])):s("",!0),"edit"===z.value?(u(),i(l,{key:1,modelValue:K.value.Name,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value.Name=e),placeholder:"节点名称（编辑时）",style:{"margin-bottom":"10px"}},null,8,["modelValue"])):s("",!0),"edit"===z.value?(u(),i(l,{key:2,modelValue:K.value.Link,"onUpdate:modelValue":a[2]||(a[2]=e=>K.value.Link=e),placeholder:"请输入节点链接，支持多行使用回车或逗号分开",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])):s("",!0),Q.value.length>0?(u(),i(t,{key:3,modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value=e),label:"1"},{default:r(()=>[...a[10]||(a[10]=[m("选择已有分组",-1)])]),_:1},8,["modelValue"])):s("",!0),n(t,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=e=>P.value=e),label:"2"},{default:r(()=>[...a[11]||(a[11]=[m("创建新分组",-1)])]),_:1},8,["modelValue"]),"1"===P.value&&Q.value.length>0?(u(),o("div",G,[n(D,{modelValue:q.value,"onUpdate:modelValue":a[5]||(a[5]=e=>q.value=e),multiple:"",placeholder:"选择已有分组",class:"default"},{default:r(()=>[(u(!0),o(c,null,p(Q.value,e=>(u(),i(g,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):s("",!0),"2"===P.value?(u(),i(l,{key:5,modelValue:B.value,"onUpdate:modelValue":a[6]||(a[6]=e=>B.value=e),placeholder:"输入要创建的分组名",class:"default"},null,8,["modelValue"])):s("",!0),n(U,{type:"primary",onClick:le},{default:r(()=>[m(f("add"===z.value?"添加":"更新"),1)]),_:1}),n(U,{onClick:a[7]||(a[7]=e=>F.value=!1)},{default:r(()=>[...a[12]||(a[12]=[m("取消",-1)])]),_:1})]),_:1},8,["modelValue","title"]),n(me,null,{default:r(()=>[n(S,{modelValue:O.value,"onUpdate:modelValue":a[9]||(a[9]=e=>O.value=e)},{default:r(()=>[n(A,{label:`全部(${W.value.length})`,name:"全部"},null,8,["label"]),(u(!0),o(c,null,p(Q.value,e=>(u(),i(A,{label:e,name:e,key:e},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),n(U,{type:"primary",onClick:ae},{default:r(()=>[...a[13]||(a[13]=[m("添加节点",-1)])]),_:1}),a[21]||(a[21]=y("div",{style:{"margin-bottom":"10px"}},null,-1)),n(X,{ref_key:"multipleTable",ref:R,data:$.value,"tooltip-effect":"dark",stripe:"",style:{width:"100%"},"row-key":"ID","tree-props":{children:"Nodes"},onSelectionChange:de},{default:r(()=>[n(J,{type:"selection",width:"55"}),n(J,{type:"index"}),n(J,{prop:"Name",label:"节点名",sortable:""},{default:r(({row:e})=>[n(H,{effect:"plain"},{default:r(()=>[m(f(e.Name),1)]),_:2},1024)]),_:1}),n(J,{prop:"Link",label:"链接","show-overflow-tooltip":!0},{default:r(({row:e})=>[n(H,{effect:"plain",type:"success"},{default:r(()=>[m(f(e.Link),1)]),_:2},1024)]),_:1}),n(J,{prop:"CreatedAt",label:"创建时间",formatter:te,sortable:"","show-overflow-tooltip":""}),n(J,{label:"所属分组",formatter:oe,"show-overflow-tooltip":""}),n(J,{label:"操作",width:"120"},{default:r(e=>[n(U,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,z.value="edit",F.value=!0,K.value={ID:l.ID,Title:"编辑节点",Name:l.Name,Link:l.Link,GroupName:(l.GroupNodes||[]).map(e=>e.Name)},q.value=K.value.GroupName||[],void(M.value=l.Name);var l}},{default:r(()=>[...a[14]||(a[14]=[m("编辑",-1)])]),_:1},8,["onClick"]),n(U,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void ue(l.Link);var l}},{default:r(()=>[...a[15]||(a[15]=[m("复制",-1)])]),_:1},8,["onClick"]),n(U,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{try{await w.confirm(`你是否要删除 ${e.Name} ?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I({id:e.ID}),k.success("删除成功")}catch(a){"cancel"!==a&&k.error("删除失败！")}await ee(),await Z(),Y()})(e.row)},{default:r(()=>[...a[16]||(a[16]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),a[22]||(a[22]=y("div",{style:{"margin-top":"20px"}},null,-1)),n(U,{type:"info",onClick:re},{default:r(()=>[...a[17]||(a[17]=[m("全选",-1)])]),_:1}),n(U,{type:"warning",onClick:ie},{default:r(()=>[...a[18]||(a[18]=[m("取消选中",-1)])]),_:1}),n(U,{type:"primary",onClick:se},{default:r(()=>[...a[19]||(a[19]=[m("复制选中",-1)])]),_:1}),n(U,{type:"danger",onClick:ne},{default:r(()=>[...a[20]||(a[20]=[m("删除选中",-1)])]),_:1}),a[23]||(a[23]=y("div",{style:{"margin-top":"20px"}},null,-1))]),_:1})])}}});export{z as default};
