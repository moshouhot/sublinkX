import{cd as e,bh as a,b as s,h as l,aE as t,_ as n,d as o,br as i,dn as r,dp as u,u as c,a as v,cV as d,r as f,dq as p,B as m,ag as g,A as y,d5 as b,C as w,o as h,ah as k,m as x,e as I,w as z,W as _,T as S,l as C,H as N,n as O,g as $,am as E,V as T,c as L,f as A,an as R,E as Y,ab as B,N as P,c0 as X,at as M,ae as j,t as D,dr as F,bH as q,q as H,ds as V,dt as W,by as G,F as K,G as Z,S as U,v as J,du as Q,cU as ee,dv as ae,z as se,ay as le,dw as te,x as ne,bd as oe,b7 as ie,b8 as re,cx as ue,I as ce,dx as ve,dy as de,dz as fe}from"./index.FgZyWN26.js";import{E as pe}from"./index.DyH_u2dd.js";import{d as me}from"./debounce.DVdHkEUe.js";function ge(a,s,l){var t=!0,n=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(l)&&(t="leading"in l?!!l.leading:t,n="trailing"in l?!!l.trailing:n),me(a,s,{leading:t,maxWait:s,trailing:n})}const ye=s({urlList:{type:l(Array),default:()=>t([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:l(String)}}),be=["src","crossorigin"];const we=J(n(o({name:"ElImageViewer",__name:"image-viewer",props:ye,emits:{close:()=>!0,error:e=>e instanceof Event,switch:e=>a(e),rotate:e=>a(e)},setup(e,{expose:a,emit:s}){var l;const t={CONTAIN:{name:"contain",icon:i(u)},ORIGINAL:{name:"original",icon:i(r)}},n=e,o=s;let J;const{t:Q}=c(),ee=v("image-viewer"),{nextZIndex:ae}=d(),se=f(),le=f(),te=p(),ne=m(()=>{const{scale:e,minScale:a,maxScale:s}=n;return g(e,a,s)}),oe=f(!0),ie=f(!1),re=f(!1),ue=f(n.initialIndex),ce=y(t.CONTAIN),ve=f({scale:ne.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),de=f(null!=(l=n.zIndex)?l:ae());b(re,{ns:ee});const fe=m(()=>{const{urlList:e}=n;return e.length<=1}),me=m(()=>0===ue.value),ye=m(()=>ue.value===n.urlList.length-1),we=m(()=>n.urlList[ue.value]),he=m(()=>[ee.e("btn"),ee.e("prev"),ee.is("disabled",!n.infinite&&me.value)]),ke=m(()=>[ee.e("btn"),ee.e("next"),ee.is("disabled",!n.infinite&&ye.value)]),xe=m(()=>{const{scale:e,deg:a,offsetX:s,offsetY:l,enableTransition:n}=ve.value;let o=s/e,i=l/e;const r=a*Math.PI/180,u=Math.cos(r),c=Math.sin(r);o=o*u+i*c,i=i*u-s/e*c;const v={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${i}px)`,transition:n?"transform .3s":""};return ce.value.name===t.CONTAIN.name&&(v.maxWidth=v.maxHeight="100%"),v}),Ie=m(()=>`${ue.value+1} / ${n.urlList.length}`);function ze(){te.stop(),null==J||J(),re.value=!1,o("close")}function _e(){oe.value=!1}function Se(e){ie.value=!0,oe.value=!1,o("error",e),e.target.alt=Q("el.image.error")}function Ce(e){if(oe.value||0!==e.button||!se.value)return;ve.value.enableTransition=!1;const{offsetX:a,offsetY:s}=ve.value,l=e.pageX,t=e.pageY,n=ge(e=>{ve.value={...ve.value,offsetX:a+e.pageX-l,offsetY:s+e.pageY-t}}),o=k(document,"mousemove",n),i=k(document,"mouseup",()=>{o(),i()});e.preventDefault()}function Ne(e){if(oe.value||!se.value||1!==e.touches.length)return;ve.value.enableTransition=!1;const{offsetX:a,offsetY:s}=ve.value,{pageX:l,pageY:t}=e.touches[0],n=ge(e=>{const n=e.touches[0];ve.value={...ve.value,offsetX:a+n.pageX-l,offsetY:s+n.pageY-t}}),o=k(document,"touchmove",n),i=k(document,"touchend",()=>{o(),i()});e.preventDefault()}function Oe(){ve.value={scale:ne.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function $e(){if(oe.value||ie.value)return;const e=G(t),a=Object.values(t),s=ce.value.name,l=(a.findIndex(e=>e.name===s)+1)%e.length;ce.value=t[e[l]],Oe()}function Ee(e){ie.value=!1;const a=n.urlList.length;ue.value=(e+a)%a}function Te(){me.value&&!n.infinite||Ee(ue.value-1)}function Le(){ye.value&&!n.infinite||Ee(ue.value+1)}function Ae(e,a={}){if(oe.value||ie.value)return;const{minScale:s,maxScale:l}=n,{zoomRate:t,rotateDeg:i,enableTransition:r}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":ve.value.scale>s&&(ve.value.scale=Number.parseFloat((ve.value.scale/t).toFixed(3)));break;case"zoomIn":ve.value.scale<l&&(ve.value.scale=Number.parseFloat((ve.value.scale*t).toFixed(3)));break;case"clockwise":ve.value.deg+=i,o("rotate",ve.value.deg);break;case"anticlockwise":ve.value.deg-=i,o("rotate",ve.value.deg)}ve.value.enableTransition=r}function Re(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Ye(){n.closeOnPressEscape&&ze()}function Be(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return w(()=>ne.value,e=>{ve.value.scale=e}),w(we,()=>{U(()=>{const e=le.value;(null==e?void 0:e.complete)||(oe.value=!0)})}),w(ue,e=>{Oe(),o("switch",e)}),h(()=>{re.value=!0,function(){const e=ge(e=>{switch(K(e)){case Z.esc:n.closeOnPressEscape&&ze();break;case Z.space:$e();break;case Z.left:Te();break;case Z.up:Ae("zoomIn");break;case Z.right:Le();break;case Z.down:Ae("zoomOut")}}),a=ge(e=>{Ae((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});te.run(()=>{k(document,"keydown",e),k(se,"wheel",a)})}(),J=k("wheel",Be,{passive:!1})}),a({setActiveItem:Ee}),(e,a)=>(I(),x($(pe),{to:"body",disabled:!e.teleported},{default:z(()=>[_(S,{name:"viewer-fade",appear:""},{default:z(()=>[C("div",{ref_key:"wrapper",ref:se,tabindex:-1,class:O($(ee).e("wrapper")),style:N({zIndex:de.value})},[_($(E),{loop:"",trapped:"","focus-trap-el":se.value,"focus-start-el":"container",onFocusoutPrevented:Re,onReleaseRequested:Ye},{default:z(()=>[C("div",{class:O($(ee).e("mask")),onClick:a[0]||(a[0]=R(a=>e.hideOnClickModal&&ze(),["self"]))},null,2),T(" CLOSE "),C("span",{class:O([$(ee).e("btn"),$(ee).e("close")]),onClick:ze},[_($(Y),null,{default:z(()=>[_($(B))]),_:1})],2),T(" ARROW "),fe.value?T("v-if",!0):(I(),L(P,{key:0},[C("span",{class:O(he.value),onClick:Te},[_($(Y),null,{default:z(()=>[_($(X))]),_:1})],2),C("span",{class:O(ke.value),onClick:Le},[_($(Y),null,{default:z(()=>[_($(M))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),L("div",{key:1,class:O([$(ee).e("btn"),$(ee).e("progress")])},[A(e.$slots,"progress",{activeIndex:ue.value,total:e.urlList.length},()=>[j(D(Ie.value),1)])],2)):T("v-if",!0),T(" ACTIONS "),C("div",{class:O([$(ee).e("btn"),$(ee).e("actions")])},[C("div",{class:O($(ee).e("actions__inner"))},[A(e.$slots,"toolbar",{actions:Ae,prev:Te,next:Le,reset:$e,activeIndex:ue.value,setActiveItem:Ee},()=>[_($(Y),{onClick:a[1]||(a[1]=e=>Ae("zoomOut"))},{default:z(()=>[_($(F))]),_:1}),_($(Y),{onClick:a[2]||(a[2]=e=>Ae("zoomIn"))},{default:z(()=>[_($(q))]),_:1}),C("i",{class:O($(ee).e("actions__divider"))},null,2),_($(Y),{onClick:$e},{default:z(()=>[(I(),x(H(ce.value.icon)))]),_:1}),C("i",{class:O($(ee).e("actions__divider"))},null,2),_($(Y),{onClick:a[3]||(a[3]=e=>Ae("anticlockwise"))},{default:z(()=>[_($(V))]),_:1}),_($(Y),{onClick:a[4]||(a[4]=e=>Ae("clockwise"))},{default:z(()=>[_($(W))]),_:1})])],2)],2),T(" CANVAS "),C("div",{class:O($(ee).e("canvas"))},[ie.value&&e.$slots["viewer-error"]?A(e.$slots,"viewer-error",{key:0,activeIndex:ue.value,src:we.value}):(I(),L("img",{ref_key:"imgRef",ref:le,key:we.value,src:we.value,style:N(xe.value),class:O($(ee).e("img")),crossorigin:e.crossorigin,onLoad:_e,onError:Se,onMousedown:Ce,onTouchstart:Ne},null,46,be))],2),A(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]])),he=s({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:l([String,Object])},previewSrcList:{type:l(Array),default:()=>t([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:l(String)}}),ke=["src","loading","crossorigin"],xe={key:0};const Ie=J(n(o({name:"ElImage",inheritAttrs:!1,__name:"image",props:he,emits:{load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>a(e),close:()=>!0,show:()=>!0},setup(e,{expose:a,emit:s}){const l=e,t=s,{t:n}=c(),o=v("image"),i=Q(),r=m(()=>ee(Object.entries(i).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),u=ae({excludeListeners:!0,excludeKeys:m(()=>Object.keys(r.value))}),d=f(),p=f(!1),g=f(!0),y=f(!1),b=f(),k=f(),_=se&&"loading"in HTMLImageElement.prototype;let S;const N=m(()=>[o.e("inner"),R.value&&o.e("preview"),g.value&&o.is("loading")]),E=m(()=>{const{fit:e}=l;return se&&e?{objectFit:e}:{}}),R=m(()=>{const{previewSrcList:e}=l;return le(e)&&e.length>0}),Y=m(()=>{const{previewSrcList:e,initialIndex:a}=l;let s=a;return a>e.length-1&&(s=0),s}),B=m(()=>"eager"!==l.loading&&(!_&&"lazy"===l.loading||l.lazy)),X=()=>{se&&(g.value=!0,p.value=!1,d.value=l.src)};function M(e){g.value=!1,p.value=!1,t("load",e)}function j(e){g.value=!1,p.value=!0,t("error",e)}const F=te(function(e){e&&(X(),H())},200,!0);async function q(){var e;if(!se)return;await U();const{scrollContainer:a}=l;if(ue(a))k.value=a;else if(ce(a)&&""!==a)k.value=null!=(e=document.querySelector(a))?e:void 0;else if(b.value){const e=ve(b.value);k.value=de(e)?void 0:e}const{stop:s}=fe(b,([e])=>{F(e.isIntersecting)},{root:k});S=s}function H(){se&&F&&(null==S||S(),k.value=void 0,S=void 0)}function V(){R.value&&(y.value=!0,t("show"))}function W(){y.value=!1,t("close")}function G(e){t("switch",e)}return w(()=>l.src,()=>{B.value?(g.value=!0,p.value=!1,H(),q()):X()}),h(()=>{B.value?q():X()}),a({showPreview:V}),(e,a)=>(I(),L("div",ne({ref_key:"container",ref:b},r.value,{class:[$(o).b(),e.$attrs.class]}),[p.value?A(e.$slots,"error",{key:0},()=>[C("div",{class:O($(o).e("error"))},D($(n)("el.image.error")),3)]):(I(),L(P,{key:1},[void 0!==d.value?(I(),L("img",ne({key:0},$(u),{src:d.value,loading:e.loading,style:E.value,class:N.value,crossorigin:e.crossorigin,onClick:V,onLoad:M,onError:j}),null,16,ke)):T("v-if",!0),g.value?(I(),L("div",{key:1,class:O($(o).e("wrapper"))},[A(e.$slots,"placeholder",{},()=>[C("div",{class:O($(o).e("placeholder"))},null,2)])],2)):T("v-if",!0)],64)),R.value?(I(),L(P,{key:2},[y.value?(I(),x($(we),{key:0,"z-index":e.zIndex,"initial-index":Y.value,infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"show-progress":e.showProgress,"url-list":e.previewSrcList,scale:e.scale,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:W,onSwitch:G},oe({toolbar:z(a=>[A(e.$slots,"toolbar",ie(re(a)))]),default:z(()=>[e.$slots.viewer?(I(),L("div",xe,[A(e.$slots,"viewer")])):T("v-if",!0)]),_:2},[e.$slots.progress?{name:"progress",fn:z(a=>[A(e.$slots,"progress",ie(re(a)))]),key:"0"}:void 0,e.$slots["viewer-error"]?{name:"viewer-error",fn:z(a=>[A(e.$slots,"viewer-error",ie(re(a)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):T("v-if",!0)],64)):T("v-if",!0)],16))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]));export{Ie as E};
